Phase 1: Install Git and Docker
  You need Git to download the source code and Docker to run the compilation environment safely.
  1. Install Git:
    - sudo dnf install -y git
  2. Install Docker: Rocky Linux doesn't have Docker in the default repo, so we add the official one.
    Online installation:
      - sudo dnf install -y yum-utils
      - sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
      - sudo dnf install -y docker-ce docker-ce-cli containerd.io
      - sudo systemctl start docker
      - sudo systemctl enable docker
      - sudo docker --version

    Offline installation:
      Step 1: Download the RPM Files (On a computer with Internet)
        You need to grab the installation files (.rpm files). You can do this from any computer \
        (Windows, Mac, or Linux) by visiting the official Docker repository for CentOS (which is \
        compatible with Rocky Linux).
        Go to this URL in your browser: https://download.docker.com/linux/centos/9/x86_64/stable/Packages/ \
        (Note: If you are on Rocky Linux 8, change the /9/ in the URL to /8/).

        Download the latest versions of these 5 specific files:
          containerd.io
          docker-ce
          docker-ce-cli
          docker-buildx-plugin
          docker-compose-plugin

        Tip: Keep these files in a single folder named docker-install so they are easy to move.

      Step 2: Transfer the Files
        Move that docker-install folder to your offline Rocky Linux server. You might use a USB drive, \
        or if you have a local network (LAN) connection, you can use scp (Secure Copy).

      Step 3: Install Docker (On the Offline Machine)
        Now, log in to your Rocky Linux server and navigate to the folder where you put the files.

        1. Go to the directory:
          - cd /path/to/your/docker-install
        2. Install the packages: Instead of using dnf install package_name (which tries to go online), we \
          tell dnf to install the files sitting right there in the folder.
          - sudo dnf install ./*.rpm
          (The ./*.rpm part tells the system: "Install every file ending in .rpm found in this current folder.")
        
        Troubleshooting Dependencies: If the installation fails saying you are missing dependencies (like \
        fuse-overlayfs or iptables), you will need to find those specific .rpm files online (using a site \
        like pkgs.org or the Rocky Linux ISO), download them, add them to your folder, and run the install \
        command again.

      Step 4: Start Docker
        Once the installation finishes successfully, you need to turn Docker on.

        1. Start the service:
          - sudo systemctl start docker
        2. Enable it (so it starts automatically after reboot):
          - sudo systemctl enable docker
        3. Verify it works:
          - sudo docker --version

      Step 5: Changing Docker images repository:
        1. add the Arvan cloud repository to your Docker service using the following command:
          - sudo bash -c 'cat > /etc/docker/daemon.json <<EOF
            {
              "insecure-registries" : ["https://docker.arvancloud.ir"],
              "registry-mirrors": ["https://docker.arvancloud.ir"]
            }
            EOF'

        2. Then enter the following commands to apply these changes:
          - docker logout
          - sudo systemctl restart docker
        
        3. Now you can access the Docker images without renaming them using the following command:
          - docker pull <ImageName>
        
        4. To use the Arvan cloud repository without making any changes to your Docker service, \
        you can use the following command:
          - docker pull docker.arvancloud.ir/<ImageName>

Phase 2: Prepare Directories
  We need two specific folders:
    A place for the Project Code (~/dev).
    A place for Java Libraries (Maven Cache) (~/m2/repository).
  Why the cache? When compiling Big Data tools, it downloads thousands of small Java files. \
  Saving them locally means you don't have to re-download them every time you restart the builder.
  Run these commands:
    - mkdir -p ~/dev
    - mkdir -p ~/m2/repository
  
Phase 3: Clone the Bigtop Repository
  Now we download the Bigtop "recipe book" (source code).
    - cd ~/dev
    - git clone https://github.com/apache/bigtop.git
    - cd bigtop
    - git fetch --all --tags
    - git checkout rel/3.5.0
    - git status

Phase 4:
  Step 1: Launch the Docker Container
    You need to start the container while "mapping" (connecting) your local folders to it. This allows \
    the container to see your source code and save downloaded Java libraries to your machine for future use.
    Make sure you are inside your git folder first:
      - cd ~/dev/bigtop
    
    Now, run this command:
      - docker run -d -it \
        --network host \
        --name bigtop-builder \
        -v $(pwd):/ws \
        -v ~/m2/repository:/root/.m2/repository \
        --workdir /ws \
        bigtop/slaves:3.5.0-rockylinux-9
    
    What this does:
      -v $(pwd):/ws: Maps your current folder (the Bigtop source code) to /ws inside the container.
      -v ~/m2/repository...: Maps your local Maven cache so downloads are saved permanently on your \
      disk, not lost when the container stops.

    Step 2: Enter the Container
      Now that the container is running in the background, log into it:
        - docker exec -it bigtop-builder /bin/bash
      You should see your command prompt change (e.g., [root@... /ws]#). You are now inside the build machine.

    Step 3: Prepare the Environment
      Inside the container, run this command to load the necessary environment variables (like Java \
      paths and Bigtop settings):
        - . /etc/profile.d/bigtop.sh
      (Note: Don't forget the dot . and space at the beginning).
      
Phase 5:
  1. Download the source file under /dl folder inside /ws directory:
    - cd dl/
    - wget https://dlcdn.apache.org/zookeeper/zookeeper-3.8.5/apache-zookeeper-3.8.5.tar.gz
  2. Run the Build Command
    Make sure you are inside the Docker container (your prompt should look different than your normal one). \
    Copy and paste this command:
      - ./gradlew zookeeper-clean zookeeper-pkg -PparentDir=/usr/bigtop -PpkgSuffix -PbuildThreads=2C repo
      What is happening?
        zookeeper-clean: Cleans up any old temporary files to ensure a fresh build.
        zookeeper-pkg: Compiles the code and wraps it into an RPM file (installable package).
        -PparentDir=/usr/bigtop: Tells the builder to install files into /usr/bigtop/.... This is the specific folder structure Ambari expects.
        -PpkgSuffix: Adds the version number to the package name (e.g., zookeeper_3_5_0), which allows Ambari to manage different versions side-by-side.
        repo: At the end, it organizes the RPMs into a proper repository structure so yum can read it later.
  
  3. Where is the output?
    Since this is your first run, it might take a while (10-20 minutes) because it has to download a lot of Java tools and dependencies.
    Once it finishes successfully (you will see BUILD SUCCESSFUL), your RPM files will be available in the output folder inside your Bigtop directory.
    Since you mapped the folders, you can see them on your host machine (outside Docker) at: ~/dev/bigtop/output/zookeeper/...

Phase 6: How to change Maven repository:
  1. Create/Edit the settings file:
    - vi /root/.m2/settings.xml
  2. Paste this content:
    <settings>
      <mirrors>
        <mirror>
          <id>aliyunmaven</id>
          <mirrorOf>*</mirrorOf>
          <name>Aliyun Public Repository</name>
          <url>https://maven.aliyun.com/repository/public</url>
        </mirror>
      </mirrors>
    </settings>
    or:
    <settings>
      <profiles>
        <profile>
          <id>standard-repos</id>
          <repositories>
            <repository>
              <id>google-maven-central</id>
              <name>Google Maven Central</name>
              <url>https://maven-central.storage-googleapis.com/repos/central/data/</url>
            </repository>
            <repository>
              <id>confluent</id>
              <name>Confluent</name>
              <url>https://packages.confluent.io/maven/</url>
            </repository>
          </repositories>
        </profile>
      </profiles>
      <activeProfiles>
        <activeProfile>standard-repos</activeProfile>
      </activeProfiles>
    </settings>
  3. Save and Exit: (Esc -> :wq -> Enter).
  